language: android
env:
  global:
  - ANDROID_TARGET=android-22
  - ANDROID_ABI=armeabi-v7a
jobs:
  include:
  - dist: trusty
    jdk: oraclejdk8
    script:
    - echo Hello, world!
    - javadoc -d build/docs/javadoc $(find app/src -name *.java)
    deploy:
      provider: script
      script: bash .utility/initiate-publish.sh
      skip_cleanup: true
      github_token: "$GITHUB_TOKEN"
      keep_history: true
      on:
        branch: master
  - jdk: oraclejdk8
    android:
      components:
      - tools
      - platform-tools
      - build-tools-23.0.3
      - android-23
      - extra-google-google_play_services
      - extra-google-m2repository
      - extra-android-m2repository
      - "$ANDROID_TARGET"
      - sys-img-${ANDROID_ABI}-${ANDROID_TARGET}
    licenses:
    - android-sdk-license-.+
    before_install:
    - openssl aes-256-cbc -K $encrypted_d5b7ee1da270_key -iv $encrypted_d5b7ee1da270_iv -in google-services.json.enc -out app/google-services.json -d
    - yes | sdkmanager "platforms;android-29"
    - chmod +x gradlew
    - wget http://services.gradle.org/distributions/gradle-5.3-bin.zip
    - unzip -qq gradle-5.3-bin.zip
    - export GRADLE_HOME=$PWD/gradle-5.3
    - export PATH=$GRADLE_HOME/bin:$PATH
    - gradle -v
    - echo no | android create avd --force -n test -t $ANDROID_TARGET --abi $ANDROID_ABI
    - emulator -avd test -no-skin -no-audio -no-window &
    - android-wait-for-emulator
    - adb shell input keyevent 82 &